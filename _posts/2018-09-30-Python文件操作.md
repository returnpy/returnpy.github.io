---
layout: post
title: Python文件操作
description: 文件IO操作
tags: Python
---

## 文件操作

### Linux中一切皆文件

- 文件操作非常重要，连网络操作都可以看成是文件操作

### 冯诺依曼体系架构

- 输入：I
- 输出：O
- 存储：内存掉电易失
- 运算
- 控制

#### 一般说IO操作，指的是文件IO，如果指的是网络IO，都会直接说网络IO

磁带最大的问题在于不能随机访问，磁盘解决了磁带不能随机访问的毛病

### 文件IO常用操作

| 打开 | 读取 | 写入  | 关闭  |  行读取  | 多行读取  | 文件指针 | 指针位置 |
| :--: | :--: | :---: | :---: | :------: | :-------: | :------: | :------: |
| open | read | write | close | readline | readlines |   seek   |   tell   |



### Open 打开操作

open(file, mode='r', buffering=-1, encoding=None, errors=None, newline=None, closefd=True, opener=None)

打开一个文件，返回一个文件对象(流对象)和文件描述符。打开失败则返回异常

文件操作流程

1. 打开

2. 读写

3. 关闭

    

文件操作中，最常用的操作就是读和写

文件访问的模式有两种：文本模式和二进制模式。不同模式下，操作函数不尽相同，表现的结果也不一样。

### open的参数

file

打开或者要创建的文件名。如果不指定路径，默认是当前路径

mode模式

| 参数 | 意义                                                     |
| ---- | -------------------------------------------------------- |
| r    | 缺省的，表示只读打开                                     |
| w    | 只写打开                                                 |
| x    | 创建并写入一个新文件                                     |
| a    | 写入打开，如果文件存在，则追加                           |
| b    | 二进制模式                                               |
| t    | 缺省的，文本模式                                         |
| +    | 读写打开文件。给原来只读、只写方式打开提供缺失的读写能力 |

open默认是只读模式r打开已经存在的文件

r：只读打开文件，如果使用write方法，会抛异常

如果文件不存在，抛出FileNotFoundError异常

w：表示只写方式打开，如果读取则抛出异常

如果文件不存在，则直接创建文件

如果文件存在，则清空文件内容

x： 

+给当前参数添加缺失的能力

### 文件指针

- mode=r，指针从0开始
- mode=a，指针起始在EOF(end of file)

- 上面的栗子说明有一个指针
    - 文件指针，指向当前字节位置
    - tell()显示指针当前位置,指的是字符的偏移量
    - seek(offset[,whence])
    - 移动文件指针位置。offset偏移多少字节，whence从哪里开始。

文本模式下，相对位置只能用0

### Buffering: 缓冲区

缓冲和缓存的区别

缓冲是一个队列，相当于一堆数据排着队放在队列中，它是有顺序的

缓存是一个字典，缓存的目的是为了快速找到存储的内容

-1表示使用缺省大小的buffer。如果是二进制模式，使用io.DEFAULT_BUFFER_SIZE值，默认是4096或者8192 默认单位值字节8k，

文本模式中，如果是终端，使用行缓冲模式，如果不是，则使用二进制模式策略

- 0只在二进制模式中使用，表示管buffer
- 1只在文本模式使用，表示使用行缓冲。意思是见到换行符就flush
- 大于1可以自由指定buffer大小

### buffer缓冲区

- 缓冲区是一个内存空间，一般来说是一个FIFO队列，等缓冲区满了或者达到阈值，数据才会flush到磁盘。
- flush()将缓冲区数据写入磁盘
- close()关闭前会调用flush()

#### buffering=0

- 这是一种特殊的二进制模式，不需要内存的buffer，可以看做是一个FIFO的文件

### 必须记住的部分

1. 文本模式，一般都用默认缓冲区大小
2. 二进制模式，是一个个字节的操作，可以指定buffer的大小
3. 一般来说，默认缓冲区大小是个比较好的选择，除非明确知道，否则不调整它
4. 一般编程中，明确知道需要写磁盘了，都会手动调用一次flush，而不是等到自动flush或者close的时候



encoding: 编码，仅文本模式下使用

windows默认GBK linux默认utf-8

utf-8是一种针对Unicode的可变长字符编码，它可以表示Unicode标准中的任何字符，且兼容ascii编码



文件描述符fileno



## read



### 上下文管理

