---
layout: post
title: Python多任务
description: 
tags: Python多任务
---

## 基本概念

并发和并行的区别

### 并行

- 同时做某些事情，可以互不干扰的同一时刻做几件事
- 你在写小学生守则的时候还看着电视就是并行
- 高速路四条车道四辆车子同时跑

### 并发

- 强调的是一段时间内处理多少事情
- 老师让你明天来上学的时候带着100遍小学生守则，你在一定时间内写100遍小学生守则就是高并发















### 工作日早晨北京交通系统需要把1500万上班族输送到指定位置这就是并发，

### 这个系统里有不同线路的地铁、公交他们在同时运转，这就是并行。

并行只是解决并发的一种手段而已

排队是天然解决并发的一种手段

### 解决并发的手段

1. 队列、缓冲区
2. 争抢  需要有一个锁机制
3. 预处理
4. 并行  并行是一种水平扩展思想
5. 提速 提高单个CPU性能，这是一种垂直扩展思想
6. 消息中间件



## 进程和线程

进程是操作系统进行资源分配的基本单位，

Linux中有父进程、子进程，Windows中进程的关系是平等的

进程像是国家，资源不共享

线程是操作系统进行调度的基本单位

线程被成为轻量级线程

一个标准的线程由线程ID，当前指令指针PC，寄存器和堆栈组成 每一个线程都有自己独立的栈

一般来说创建一个进程比创建一个线程快10-100倍

线程像是省份，可以资源共享

CPU像是联合国，进程是国家，线程是身份，台湾领导人申请加入联合国，是不是在搞笑

我们写的是代码，代码通过编译之后就是程序，程序跑起来就是进程，进程是指令和数据的集合

### 线程的状态

| 状态 | 含义                                                         |
| ---- | ------------------------------------------------------------ |
| 就绪 | 线程能够运行，但是等待被调度，可能刚刚创建，也由可能刚刚从阻塞中恢复 |
| 运行 | 线程正在运行                                                 |
| 阻塞 | 线程等待外部事件发生而无法运行                               |
| 终止 | 线程完成，退出，或者被取消                                   |

操作系统调度策略，时间片轮转，优先级调度





## Python中的进程和线程

### Python中的线程开发

Python中的线程开发使用标准库threading

### Thread类

```python
def __init__(self, group=None, target=None, name=None, args=(), kwargs=None, *, daemon=None):
    
```

| 参数   | 含义                         |
| ------ | ---------------------------- |
| target | 线程调用的对象，就是目标函数 |
| name   | 为线程起个名字               |
| args   | 为目标函数传递实参，元祖     |
| kwargs | 为目标函数关键字传参数，字典 |

### 线程的退出

Python中并没有提供线程退出的方法

线程退出有两种情况，

1. 线程执行完成
2. 线程抛出异常

线程传参和函数传参没什么区别，本质上就是函数传参

## threading的属性和方法

| 名称             | 含义                                               |
| ---------------- | -------------------------------------------------- |
| current_thread() | 返回当前线程对象                                   |
| main_thread()    | 返回主线程对象                                     |
| active_count()   | 当前处于alive状态的线程个数                        |
| enumerate()      | 返回所有活着的线程列表，不包括已经终止未开始的线程 |
| get_ident()      | 返回当前线程的ID,非0整数                           |

### Thread实例的属性和方法

| 名称       | 含义                                                         |
| ---------- | ------------------------------------------------------------ |
| name       | 只是一个名称，标识符，可重复，通过getName()、setName()获取、设置 |
| ident      | 线程ID，线程启动后才会有ID,否则为None，线程退出，依旧可以访问，可重复使用 |
| is_alive() | 查看线程是否活着                                             |

